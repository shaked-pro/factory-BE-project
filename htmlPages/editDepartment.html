<!DOCTYPE html>
<html>

<head>
    <title>Edit Department</title>
</head>

<body onload="getRelevantDepartmentData()">
    <h1>Edit Department</h1>
    Department ID = <input type="text" id="id" /><br /> <br />
    Department Manager = <input type="text" id="manager"><br /><br />
    Department Name = <input type="text" id="name" /><br /><br />

    <button onclick="changeData()">Save and Confirm</button>
    <button onclick="DeleteDep()">Delete Department</button>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        async function getRelevantDepartmentData() {
            let params = new URLSearchParams(window.location.search); // Getting the selected department name
            let departmentName = params.get('department');
            console.log('Department Name = ' + departmentName);

            if (!departmentName) {
                console.error('the department was not provided in the URL');
                return;
            }

            let headers = {
                'depname': departmentName,
            };

            try {
                const response = await axios.get('http://localhost:3000/departments/editDepartment', { headers });
                const departmentData = response.data;
                console.log (departmentData._id);
            
                document.getElementById('id').value = departmentData._id; // Placing the values
                document.getElementById('manager').value = departmentData.Department_Manager;
                document.getElementById('name').value = departmentData.Department_Name;
            } catch (error) {
                console.error('Error fetching Department data: '+ error);
            }
        }
        // async function changeData() {
        //     let params = new URLSearchParams(window.location.search);
        //     let departmentName = params.get('department');
        //     console.log('department name = ' + departmentName);

        //     let headers = {
        //         'departmentname': departmentName,
        //         'newId': document.getElementById('id').value,  // getting the new values
        //         'newFirst': document.getElementById('firstName').value,
        //         'newYear': document.getElementById('year').value,
        //         'newDep': document.getElementById('department').value
        //     };
        //     let updateResponse = await axios.post('http://localhost:3000/employees/editEmployee', headers);
        //     console.log("updated employee from html page : " + JSON.stringify(updateResponse.data));
        // }
         async function DeleteDep() {
                let params = new URLSearchParams(window.location.search);
                let departmentId = document.getElementById('id').value;
                console.log('department id = ' + departmentId);

                let dataParams = {
                    departmentid: departmentId
                };
                let deleteResponse = await axios.delete('http://localhost:3000/departments/editDepartment', {data:dataParams});
                if (deleteResponse==true)
                {
                    alert ("department was deleted successfully!");
                }
                else 
                {
                    alert ("operation couldn't be completed");
                }
            }
    </script>
</body>

</html>